"use strict";(globalThis.webpackChunk_pwargulak_sd_esm_reports_app=globalThis.webpackChunk_pwargulak_sd_esm_reports_app||[]).push([[547],{547:(e,t,n)=>{n.r(t),n.d(t,{default:()=>A});var r=n(2246),o=n(1672),a=n.n(o),l=n(3397),c=n(1595),i=n(1132),u=n(4672),s=n(9675),d=n(9658),p=n(9160),m=n(2254),f=n(9142),v=n(9411),h=n(6134),E=n(1326),y=n(5241),w=n(7656),b="SAVED",g="COMPLETED";const k=function(e){var t=e.status,n=(0,l.useTranslation)().t;return a().createElement(a().Fragment,null,t===b&&a().createElement(a().Fragment,null,a().createElement(w.kF,{size:16,className:"".concat(f.Z.statusIcon," ").concat(f.Z.successIcon)}),n("completedAndPreserved","Completed and Preserved")),t===g&&a().createElement(a().Fragment,null,a().createElement(w.Wz,{size:16,className:"".concat(f.Z.statusIcon," ").concat(f.Z.successIcon)}),n("completed","Completed")),"PROCESSING"===t&&a().createElement(a().Fragment,null,a().createElement(r.gbz,{small:!0,withOverlay:!1,className:"".concat(f.Z.statusIcon," ").concat(f.Z.runningIcon)}),n("running","Running")),"FAILED"===t&&a().createElement(a().Fragment,null,a().createElement(w.yv,{size:16,className:"".concat(f.Z.statusIcon," ").concat(f.Z.failedIcon)}),n("failed","Failed")),"SCHEDULED"===t&&a().createElement(a().Fragment,null,a().createElement("span",{className:f.Z.scheduledStatusText},n("scheduled","Scheduled"))),"SCHEDULE_COMPLETED"===t&&a().createElement(a().Fragment,null,a().createElement("span",{className:f.Z.scheduleCompletedStatusText},n("scheduleCompleted","Schedule completed"))),"REQUESTED"===t&&a().createElement(a().Fragment,null,a().createElement(s.j8,{size:16,className:"".concat(f.Z.statusIcon)}),n("queued","Queued")))};var Z=n(3152),S=n(9331);function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function R(e,t,n,r,o,a,l){try{var c=e[a](l),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,o)}function D(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function l(e){R(a,r,o,l,c,"next",e)}function c(e){R(a,r,o,l,c,"throw",e)}l(void 0)}))}}function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],l=!0,c=!1;try{for(n=n.call(e);!(l=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{l||null==n.return||n.return()}finally{if(c)throw o}}return a}}(e,t)||I(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){if(e){if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}function T(e,t){var n,r,o,a,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return l.label++,{value:a[1],done:!1};case 5:l.label++,r=a[1],a=[0];continue;case 7:a=l.ops.pop(),l.trys.pop();continue;default:if(!((o=(o=l.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){l=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){l.label=a[1];break}if(6===a[0]&&l.label<o[1]){l.label=o[1],o=a;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(a);break}o[2]&&l.ops.pop(),l.trys.pop();continue}a=t.call(e,l)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}const A=function(){var e=function(e){var t,n;return null===(n=e)||void 0===n||null===(t=n.cells.find((function(e){var t;return"status"===(null===(t=e.info)||void 0===t?void 0:t.header)})))||void 0===t?void 0:t.value},t=function(e){return function(e){var t,n;return(null===(t=J.find((function(t){return t.id===e})))||void 0===t?void 0:t.requestedByUserUuid)===(null===(n=R)||void 0===n?void 0:n.user.uuid)}(e)||(0,i.userHasAccess)(S.q_,R.user)},n=function(e){var t,n,r=null===(t=e)||void 0===t?void 0:t.target,o=r.id,a=o.slice(o.indexOf("-")+1),l=null===(n=r)||void 0===n?void 0:n.checked;x((function(e){return l&&!e.includes(a)?(t=e,function(e){if(Array.isArray(e))return C(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||I(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([a]):e.filter((function(e){return e!==a}));var t}))},w=(0,l.useTranslation)().t,R=(0,i.useSession)(),A=N((0,o.useState)([]),2),F=A[0],x=A[1],z=N((0,o.useState)(!1),2),B=z[0],P=z[1];(0,o.useEffect)((function(){P(F.length>0)}),[F]);var U,O,q,_,L=[{key:"reportName",header:w("reportName","Report Name")},{key:"status",header:w("status","Status")},{key:"requestedBy",header:w("requestedBy","Requested by")},{key:"requestedOn",header:w("requestedOn","Requested on")},{key:"outputFormat",header:w("outputFormat","Output format")},{key:"parameters",header:w("parameters","Parameters")},{key:"actions",header:w("actions","Actions")}],M=N((0,o.useState)(v.Kp),2),j=M[0],H=M[1],W=N((0,o.useState)(v.L8),2),Q=W[0],V=W[1],G=(0,c.xC)("ran",j,Q),J=G.reports,K=G.reportsTotalCount,$=G.mutateReports,X=(0,i.useLayoutType)(),Y=(0,o.useCallback)((U=D((function(e){return T(this,(function(t){return(0,c.Wg)(e).then((function(){$(),(0,i.showToast)({critical:!0,kind:"success",title:w("preserveReport","Preserve report"),description:w("reportPreservedSuccessfully","Report preserved successfully")})})).catch((function(e){(0,i.showToast)({critical:!0,kind:"error",title:w("preserveReport","Preserve report"),description:w("reportPreservingErrorMsg","Error during report preserving")})})),[2]}))})),function(e){return U.apply(this,arguments)}),[]),ee=(0,o.useCallback)(function(){var e=D((function(e){var t;return T(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,(0,c.wv)(e)];case 1:return t=n.sent(),ne(t),re(),(0,i.showToast)({critical:!0,kind:"success",title:w("downloadReport","Download report"),description:w("reportDownloadedSuccessfully","Report downloaded successfully")}),[3,3];case 2:return n.sent(),(0,i.showToast)({critical:!0,kind:"error",title:w("downloadReport","Download report"),description:w("reportDownloadingErrorMsg","Error during report downloading")}),[3,3];case 3:return[2]}}))}));return function(t){return e.apply(this,arguments)}}(),[]),te=(0,o.useCallback)(function(){var e=D((function(e){return T(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(0,c.k5)(e)];case 1:return t.sent().forEach((function(e){return ne(e)})),re(),(0,i.showToast)({critical:!0,kind:"success",title:w("downloadReport","Download report(s)"),description:w("reportDownloadedSuccessfully","Report(s) downloaded successfully")}),[3,3];case 2:return t.sent(),(0,i.showToast)({critical:!0,kind:"error",title:w("downloadReport","Download report(s)s"),description:w("reportDownloadingErrorMsg","Error during report(s) downloading")}),[3,3];case 3:return[2]}}))}));return function(t){return e.apply(this,arguments)}}(),[]),ne=function(e){for(var t=window.atob(e.fileContent),n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);var o=window.URL.createObjectURL(new Blob([n])),a=document.createElement("a");a.href=o,a.setAttribute("download",e.filename),document.body.appendChild(a),a.click(),document.body.removeChild(a)},re=function(){x([])};return a().createElement("div",null,a().createElement(i.ExtensionSlot,{name:"breadcrumbs-slot",className:f.Z.breadcrumb}),a().createElement("div",{className:f.Z.mainPanelDiv},a().createElement("div",{className:f.Z.reportsLabelDiv},a().createElement("h3",null,w("reports","Reports"))),a().createElement("div",{className:f.Z.mainActionButtonsDiv},a().createElement(r.zxk,{kind:"ghost",renderIcon:function(){return a().createElement(u.UW,{size:16,style:{fill:"#0F62FE"},className:f.Z.actionButtonIcon})},iconDescription:"Download reports",onClick:function(){return te(F.join(","))},className:"".concat(f.Z.mainActionButton," ").concat(B?f.Z.downloadReportsVisible:f.Z.downloadReportsHidden)},w("downloadReports","Download reports")),a().createElement(r.zxk,{kind:"ghost",renderIcon:function(){return a().createElement(s.sh,{size:16,style:{fill:"#0F62FE"},className:f.Z.actionButtonIcon})},iconDescription:"Run reports",onClick:function(){(0,h.I8)(w("runReport","Run Report"),a().createElement(E.default,{closePanel:function(){(0,h.Km)(),$()}}))},className:f.Z.mainActionButton},w("runReports","Run reports")),a().createElement(y.Z,null),a().createElement(r.zxk,{kind:"ghost",renderIcon:function(){return a().createElement(d.f,{size:16,style:{fill:"#0F62FE"},className:f.Z.actionButtonIcon})},iconDescription:"Report schedule",onClick:function(){return(0,i.navigate)({to:"${openmrsSpaBase}/reports/scheduled-overview"})},className:f.Z.mainActionButton},w("reportSchedule","Report schedule")))),a().createElement(r.wQF,{rows:J,headers:L,isSortable:!0},(function(o){var l=o.rows,c=o.headers;return a().createElement(r.xJi,null,a().createElement(r.iA_,null,a().createElement(r.ssF,null,a().createElement(r.SCH,null,a().createElement("th",null),c.map((function(e){var t;return a().createElement(r.xDH,null,null!==(O=null===(t=e.header)||void 0===t?void 0:t.content)&&void 0!==O?O:e.header)})))),a().createElement(r.RMI,null,l.map((function(o,l){return a().createElement(r.SCH,{className:f.Z.tableRow},function(e,t){var o,l,c=null===(l=null===(o=e)||void 0===o?void 0:o.cells.find((function(e){var t;return"status"===(null===(t=e.info)||void 0===t?void 0:t.header)})))||void 0===l?void 0:l.value;return c===g||c===b?a().createElement("td",{className:t%2==0?f.Z.rowCellEven:f.Z.rowCellOdd},a().createElement(r.XZJ,{id:"checkbox-".concat(e.id),onChange:function(e){return n(e)},checked:F.includes(e.id)})):a().createElement("td",{className:t%2==0?f.Z.rowCellEven:f.Z.rowCellOdd})}(o,l),o.cells.map((function(n){var c,s;return a().createElement(r.pj1,{className:l%2==0?f.Z.rowCellEven:f.Z.rowCellOdd},"actions"===n.info.header?a().createElement("div",null,a().createElement(Z.Z,{shouldBeDisplayed:e(o)===g||e(o)===b,label:w("download","Download"),icon:function(){return a().createElement(u.UW,{size:16,className:f.Z.actionButtonIcon})},reportRequestUuid:o.id,onClick:function(){return ee(o.id)}}),a().createElement(Z.Z,{shouldBeDisplayed:e(o)===g&&t(o.id),label:w("preserve","Preserve"),icon:function(){return a().createElement(p.vc,{size:16,className:f.Z.actionButtonIcon})},reportRequestUuid:o.id,onClick:function(){return Y(o.id)}}),a().createElement(Z.Z,{shouldBeDisplayed:t(o.id),label:w("delete","Delete"),icon:function(){return a().createElement(m.ZN,{size:16,className:f.Z.actionButtonIcon})},reportRequestUuid:o.id,onClick:function(){return e=o.id,void(t=(0,i.showModal)("cancel-report-modal",{closeModal:function(){t(),$()},reportRequestUuid:e,modalType:"delete"}));var e,t}})):"status"===n.info.header?a().createElement("div",null,a().createElement(k,{status:n.value})):"reportName"===n.info.header?a().createElement("div",null,null!==(q=null===(c=n.value)||void 0===c?void 0:c.content)&&void 0!==q?q:n.value):null!==(_=null===(s=n.value)||void 0===s?void 0:s.content)&&void 0!==_?_:n.value)})))})))))})),J.length>0?a().createElement(r.tlE,{backwardText:w("previousPage","Previous page"),forwardText:w("nextPage","Next page"),page:j,pageSize:Q,pageSizes:v.VZ,totalItems:K,size:(0,i.isDesktop)(X)?"sm":"lg",onChange:function(e){var t=e.pageSize,n=e.page;t!==Q&&V(t),n!==j&&H(n)}}):null)}}}]);